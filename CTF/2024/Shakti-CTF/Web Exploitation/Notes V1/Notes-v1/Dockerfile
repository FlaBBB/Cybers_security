FROM ubuntu:latest

RUN apt-get update && \
    apt-get install -y \
    wget \
    gcc \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

RUN wget https://golang.org/dl/go1.17.5.linux-amd64.tar.gz && \
    tar -xvf go1.17.5.linux-amd64.tar.gz && \
    mv go /usr/local

ENV PATH=$PATH:/usr/local/go/bin
ENV GOPATH=/go

COPY templates/ /templates

COPY requirements.txt /requirements.txt
RUN pip3 install -r /requirements.txt

COPY main.go /go/src/main.go

RUN go build -o /usr/local/bin/reverse_proxy /go/src/main.go

EXPOSE 8000

COPY app.py /app.py

COPY flag.txt /flag.txt

WORKDIR /

COPY start_servers.sh /start_servers.sh

RUN chmod +x /start_servers.sh

CMD ["/start_servers.sh"]
