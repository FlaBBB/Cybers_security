/* This file was generated by the Hex-Rays decompiler version 8.3.0.230608.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 (**init_proc())(void);
void sub_1020();
// void free(void *ptr);
// int putchar(int c);
// size_t strlen(const char *s);
// int printf(const char *format, ...);
// void *memset(void *s, int c, size_t n);
// void *memcpy(void *dest, const void *src, size_t n);
// void *malloc(size_t size);
// __int64 __isoc99_scanf(const char *, ...); weak
// void __noreturn exit(int status);
// size_t fwrite(const void *ptr, size_t size, size_t n, FILE *s);
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void));
FILE **sub_1110();
__int64 sub_1140(void); // weak
FILE **sub_1180();
__int64 sub_11D0();
__int64 sub_11D9(); // weak
__int64 __fastcall sub_120B(__int64 a1, unsigned int a2, unsigned int a3, int a4);
void *__fastcall sub_125F(const char *a1);
_DWORD *__fastcall sub_12CA(_DWORD *a1);
__int64 __fastcall sub_228F(__int64 a1);
__int64 __fastcall sub_22EB(__int64 a1);
__int64 __fastcall main(int a1, char **a2, char **a3);
__int64 __fastcall sub_26D2(unsigned __int8 a1);
__int64 __fastcall sub_26F5(unsigned __int8 *a1);
__int64 __fastcall sub_274D(unsigned __int8 a1);
unsigned __int8 *__fastcall sub_2769(unsigned __int8 *a1, unsigned __int8 a2);
unsigned __int64 __fastcall sub_27E7(__int64 a1, __int64 a2, unsigned int a3, unsigned __int64 a4);
void __fastcall sub_2977(__int64 a1);
__int64 __fastcall sub_29C9(__int64 a1);
__int64 __fastcall sub_2A0C(char *a1, unsigned __int8 a2);
_BYTE *__fastcall sub_2A80(__int64 a1, __int64 a2);
__int64 __fastcall sub_2AD6(char a1, unsigned __int8 a2);
unsigned __int64 __fastcall sub_2B30(__int64 a1);
unsigned __int64 __fastcall sub_2BF8(_BYTE *a1);
_BYTE *__fastcall sub_2DD7(__int64 a1, __int64 a2);
__int64 __fastcall sub_2E21(__int64 a1, __int64 a2);
unsigned __int64 __fastcall sub_2E8E(__int64 a1, __int64 a2, int a3);
__int64 __fastcall sub_2F85(__int64 a1, __int64 a2, __int64 a3, unsigned int a4);
void term_proc();
// int __fastcall _libc_start_main(int (__fastcall *main)(int, char **, char **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void), void *stack_end);
// int __fastcall _cxa_finalize(void *);
// __int64 _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

void *off_6068 = &off_6068; // idb
unsigned __int8 byte_6080[32] =
{
  0u,
  1u,
  2u,
  4u,
  8u,
  16u,
  32u,
  64u,
  128u,
  27u,
  54u,
  108u,
  216u,
  171u,
  77u,
  154u,
  47u,
  94u,
  188u,
  99u,
  198u,
  151u,
  53u,
  106u,
  212u,
  179u,
  125u,
  250u,
  239u,
  197u,
  145u,
  57u
}; // weak
FILE *stderr; // idb
char byte_60A8; // weak
int dword_60C0; // weak
unsigned int dword_60E0[256]; // weak


//----- (0000000000001000) ----------------------------------------------------
__int64 (**init_proc())(void)
{
  __int64 (**result)(void); // rax

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    return (__int64 (**)(void))_gmon_start__();
  return result;
}
// 6550: using guessed type __int64 _gmon_start__(void);

//----- (0000000000001020) ----------------------------------------------------
void sub_1020()
{
  JUMPOUT(0LL);
}
// 1026: control flows out of bounds to 0

//----- (00000000000010E0) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void))
{
  __int64 v3; // rax
  int v4; // esi
  __int64 v5; // [rsp-8h] [rbp-8h] BYREF
  char *retaddr; // [rsp+0h] [rbp+0h] BYREF

  v4 = v5;
  v5 = v3;
  _libc_start_main(main, v4, &retaddr, 0LL, 0LL, a3, &v5);
  __halt();
}
// 10EA: positive sp value 8 has been found
// 10F1: variable 'v3' is possibly undefined

//----- (0000000000001110) ----------------------------------------------------
FILE **sub_1110()
{
  return &stderr;
}

//----- (0000000000001140) ----------------------------------------------------
__int64 sub_1140()
{
  return 0LL;
}
// 1140: using guessed type __int64 sub_1140();

//----- (0000000000001180) ----------------------------------------------------
FILE **sub_1180()
{
  FILE **result; // rax

  if ( !byte_60A8 )
  {
    if ( &_cxa_finalize )
      _cxa_finalize(off_6068);
    result = sub_1110();
    byte_60A8 = 1;
  }
  return result;
}
// 60A8: using guessed type char byte_60A8;

//----- (00000000000011D0) ----------------------------------------------------
// attributes: thunk
__int64 sub_11D0()
{
  return sub_1140();
}
// 1140: using guessed type __int64 sub_1140(void);

//----- (00000000000011D9) ----------------------------------------------------
__int64 sub_11D9()
{
  __int64 result; // rax

  __asm { int     80h; LINUX - }
  result = 4294967270LL;
  dword_60C0 = -26;
  return result;
}
// 11D9: using guessed type __int64 sub_11D9();
// 60C0: using guessed type int dword_60C0;

//----- (000000000000120B) ----------------------------------------------------
__int64 __fastcall sub_120B(__int64 a1, unsigned int a2, unsigned int a3, int a4)
{
  __int64 result; // rax

  result = a2;
  if ( (int)a2 <= (int)a3 )
  {
    *(_DWORD *)(a1 + 4LL * a4) = a2;
    return sub_120B(a1, a2 + 1, a3, (unsigned int)(a4 + 1));
  }
  return result;
}

//----- (000000000000125F) ----------------------------------------------------
void *__fastcall sub_125F(const char *a1)
{
  void *v2; // [rsp+8h] [rbp-8h]

  v2 = malloc(0x404uLL);
  if ( !v2 )
  {
    fwrite("Memory allocation failed.\n", 1uLL, 0x1AuLL, stderr);
    exit(1);
  }
  sub_120B((__int64)v2, 0, 0xFFu, 0);
  return v2;
}

//----- (00000000000012CA) ----------------------------------------------------
_DWORD *__fastcall sub_12CA(_DWORD *a1)
{
  _DWORD *result; // rax

  *a1 = 328;
  a1[1] = 446;
  a1[2] = 451;
  a1[3] = 191;
  a1[4] = 148;
  a1[5] = 482;
  a1[6] = 221;
  a1[7] = 477;
  a1[8] = 1;
  a1[9] = 237;
  a1[10] = 325;
  a1[11] = 43;
  a1[12] = 207;
  a1[13] = 446;
  a1[14] = 336;
  a1[15] = 471;
  a1[16] = 484;
  a1[17] = 163;
  a1[18] = 294;
  a1[19] = 152;
  a1[20] = 314;
  a1[21] = 152;
  a1[22] = 10;
  a1[23] = 49;
  a1[24] = 42;
  a1[25] = 337;
  a1[26] = 240;
  a1[27] = 295;
  a1[28] = 140;
  a1[29] = 205;
  a1[30] = 313;
  a1[31] = 433;
  a1[32] = 202;
  a1[33] = 219;
  a1[34] = 324;
  a1[35] = 458;
  a1[36] = 130;
  a1[37] = 161;
  a1[38] = 240;
  a1[39] = 174;
  a1[40] = 406;
  a1[41] = 136;
  a1[42] = 82;
  a1[43] = 106;
  a1[44] = 77;
  a1[45] = 497;
  a1[46] = 314;
  a1[47] = 8;
  a1[48] = 432;
  a1[49] = 334;
  a1[50] = 299;
  a1[51] = 397;
  a1[52] = 305;
  a1[53] = 190;
  a1[54] = 420;
  a1[55] = 73;
  a1[56] = 216;
  a1[57] = 230;
  a1[58] = 289;
  a1[59] = 15;
  a1[60] = 446;
  a1[61] = 418;
  a1[62] = 276;
  a1[63] = 483;
  a1[64] = 19;
  a1[65] = 375;
  a1[66] = 416;
  a1[67] = 312;
  a1[68] = 89;
  a1[69] = 280;
  a1[70] = 200;
  a1[71] = 159;
  a1[72] = 448;
  a1[73] = 412;
  a1[74] = 218;
  a1[75] = 147;
  a1[76] = 101;
  a1[77] = 12;
  a1[78] = 344;
  a1[79] = 291;
  a1[80] = 32;
  a1[81] = 496;
  a1[82] = 366;
  a1[83] = 10;
  a1[84] = 469;
  a1[85] = 444;
  a1[86] = 82;
  a1[87] = 49;
  a1[88] = 384;
  a1[89] = 7;
  a1[90] = 28;
  a1[91] = 188;
  a1[92] = 116;
  a1[93] = 296;
  a1[94] = 2;
  a1[95] = 225;
  a1[96] = 3;
  a1[97] = 234;
  a1[98] = 196;
  a1[99] = 4;
  a1[100] = 343;
  a1[101] = 405;
  a1[102] = 124;
  a1[103] = 407;
  a1[104] = 337;
  a1[105] = 405;
  a1[106] = 439;
  a1[107] = 413;
  a1[108] = 418;
  a1[109] = 496;
  a1[110] = 67;
  a1[111] = 199;
  a1[112] = 189;
  a1[113] = 144;
  a1[114] = 438;
  a1[115] = 290;
  a1[116] = 163;
  a1[117] = 74;
  a1[118] = 261;
  a1[119] = 32;
  a1[120] = 500;
  a1[121] = 273;
  a1[122] = 455;
  a1[123] = 428;
  a1[124] = 469;
  a1[125] = 421;
  a1[126] = 2;
  a1[127] = 340;
  a1[128] = 273;
  a1[129] = 268;
  a1[130] = 356;
  a1[131] = 159;
  a1[132] = 136;
  a1[133] = 268;
  a1[134] = 279;
  a1[135] = 225;
  a1[136] = 280;
  a1[137] = 392;
  a1[138] = 49;
  a1[139] = 315;
  a1[140] = 260;
  a1[141] = 165;
  a1[142] = 295;
  a1[143] = 465;
  a1[144] = 269;
  a1[145] = 137;
  a1[146] = 40;
  a1[147] = 132;
  a1[148] = 402;
  a1[149] = 100;
  a1[150] = 493;
  a1[151] = 194;
  a1[152] = 483;
  a1[153] = 181;
  a1[154] = 76;
  a1[155] = 379;
  a1[156] = 499;
  a1[157] = 390;
  a1[158] = 98;
  a1[159] = 56;
  a1[160] = 57;
  a1[161] = 298;
  a1[162] = 233;
  a1[163] = 422;
  a1[164] = 84;
  a1[165] = 109;
  a1[166] = 131;
  a1[167] = 341;
  a1[168] = 275;
  a1[169] = 334;
  a1[170] = 476;
  a1[171] = 185;
  a1[172] = 6;
  a1[173] = 375;
  a1[174] = 291;
  a1[175] = 44;
  a1[176] = 57;
  a1[177] = 104;
  a1[178] = 158;
  a1[179] = 73;
  a1[180] = 94;
  a1[181] = 155;
  a1[182] = 304;
  a1[183] = 81;
  a1[184] = 254;
  a1[185] = 487;
  a1[186] = 439;
  a1[187] = 272;
  a1[188] = 106;
  a1[189] = 85;
  a1[190] = 265;
  a1[191] = 364;
  a1[192] = 475;
  a1[193] = 99;
  a1[194] = 56;
  a1[195] = 431;
  a1[196] = 445;
  a1[197] = 125;
  a1[198] = 491;
  a1[199] = 136;
  a1[200] = 252;
  a1[201] = 342;
  a1[202] = 98;
  a1[203] = 167;
  a1[204] = 230;
  a1[205] = 239;
  a1[206] = 390;
  a1[207] = 350;
  a1[208] = 277;
  a1[209] = 370;
  a1[210] = 176;
  a1[211] = 433;
  a1[212] = 327;
  a1[213] = 249;
  a1[214] = 277;
  a1[215] = 207;
  a1[216] = 340;
  a1[217] = 67;
  a1[218] = 261;
  a1[219] = 352;
  a1[220] = 153;
  a1[221] = 472;
  a1[222] = 291;
  a1[223] = 155;
  a1[224] = 273;
  a1[225] = 420;
  a1[226] = 248;
  a1[227] = 57;
  a1[228] = 323;
  a1[229] = 281;
  a1[230] = 338;
  a1[231] = 150;
  a1[232] = 367;
  a1[233] = 148;
  a1[234] = 332;
  a1[235] = 91;
  a1[236] = 257;
  a1[237] = 73;
  a1[238] = 204;
  a1[239] = 162;
  a1[240] = 388;
  a1[241] = 233;
  a1[242] = 334;
  a1[243] = 388;
  a1[244] = 74;
  a1[245] = 224;
  a1[246] = 99;
  a1[247] = 84;
  a1[248] = 19;
  a1[249] = 421;
  a1[250] = 47;
  a1[251] = 279;
  a1[252] = 429;
  a1[253] = 181;
  a1[254] = 188;
  result = a1 + 255;
  a1[255] = 37;
  return result;
}

//----- (000000000000228F) ----------------------------------------------------
__int64 __fastcall sub_228F(__int64 a1)
{
  __int64 result; // rax
  int i; // [rsp+1Ch] [rbp-4h]

  for ( i = 0; ; ++i )
  {
    result = *(unsigned __int8 *)(i + a1);
    if ( !(_BYTE)result )
      break;
    *(_BYTE *)(i + a1) ^= (_BYTE)i + 15;
  }
  return result;
}

//----- (00000000000022EB) ----------------------------------------------------
__int64 __fastcall sub_22EB(__int64 a1)
{
  return sub_228F(a1, "69*x^0x8we82130d");
}
// 228F: using guessed type __int64 __fastcall sub_228F(_QWORD, _QWORD);

//----- (0000000000002318) ----------------------------------------------------
__int64 __fastcall main(int a1, char **a2, char **a3)
{
  void *v3; // rsp
  void *v4; // rsp
  __int64 *v5; // rax
  __int64 v6; // rdx
  char **v8; // [rsp+0h] [rbp-8D0h] BYREF
  int v9; // [rsp+Ch] [rbp-8C4h]
  int i; // [rsp+1Ch] [rbp-8B4h]
  int j; // [rsp+20h] [rbp-8B0h]
  int v12; // [rsp+24h] [rbp-8ACh]
  unsigned int v13; // [rsp+28h] [rbp-8A8h]
  int v14; // [rsp+2Ch] [rbp-8A4h]
  int v15; // [rsp+30h] [rbp-8A0h]
  int v16; // [rsp+34h] [rbp-89Ch]
  int v17; // [rsp+38h] [rbp-898h]
  int c; // [rsp+3Ch] [rbp-894h]
  __int64 v19; // [rsp+40h] [rbp-890h]
  char ***v20; // [rsp+48h] [rbp-888h]
  void *src; // [rsp+50h] [rbp-880h]
  void *v22; // [rsp+58h] [rbp-878h]
  __int64 v23; // [rsp+60h] [rbp-870h]
  void *dest; // [rsp+68h] [rbp-868h]
  __int64 v25[2]; // [rsp+70h] [rbp-860h] BYREF
  char v26[16]; // [rsp+80h] [rbp-850h] BYREF
  char s[32]; // [rsp+90h] [rbp-840h] BYREF
  char v28[1024]; // [rsp+B0h] [rbp-820h] BYREF
  char v29[1032]; // [rsp+4B0h] [rbp-420h] BYREF
  unsigned __int64 v30; // [rsp+8B8h] [rbp-18h]

  v9 = a1;
  v8 = a2;
  v30 = __readfsqword(0x28u);
  v12 = 176;
  v19 = 175LL;
  v3 = alloca(176LL);
  v20 = &v8;
  __isoc99_scanf("%[^\n]16s", v28);
  __isoc99_scanf("%1024s", v29);
  v13 = 16;
  src = (void *)sub_125F("%1024s", v29);
  sub_27E7(v20, v28, v13, v12);
  qmemcpy(s, "[yb2zg5w7k|yiyi$", 16);
  s[16] = 15;
  memcpy(&dword_60E0, src, 0x400uLL);
  if ( dword_60C0 )
  {
    v22 = malloc(0x400uLL);
    sub_12CA(v22);
    memcpy(&dword_60E0, v22, 0x400uLL);
  }
  sub_22EB(s);
  v14 = strlen(s);
  v15 = strlen(v29);
  v16 = (v15 + v14) / 16 + 1;
  v17 = 16 * v16;
  v23 = 16 * v16 - 1LL;
  v4 = alloca(16 * ((16 * v16 + 15LL) / 0x10uLL));
  dest = &v8;
  memcpy(&v8, s, v14);
  memcpy((char *)dest + v14, v29, v15);
  c = v17 - v14 - v15;
  memset((char *)dest + v15 + (__int64)v14, c, c);
  for ( i = 0; i < v16; ++i )
  {
    v5 = (__int64 *)((char *)dest + 16 * i);
    v6 = v5[1];
    v25[0] = *v5;
    v25[1] = v6;
    sub_2F85(v25, v26, v28, 16LL);
    for ( j = 0; j <= 15; ++j )
      printf("%2.2x", (unsigned __int8)v26[j]);
  }
  putchar(10);
  return 0LL;
}
// 10B0: using guessed type __int64 __isoc99_scanf(const char *, ...);
// 125F: using guessed type __int64 sub_125F(const char *, ...);
// 12CA: using guessed type __int64 __fastcall sub_12CA(_QWORD);
// 22EB: using guessed type __int64 __fastcall sub_22EB(_QWORD);
// 27E7: using guessed type __int64 __fastcall sub_27E7(_QWORD, _QWORD, _QWORD, _QWORD);
// 2F85: using guessed type __int64 __fastcall sub_2F85(_QWORD, _QWORD, _QWORD, _QWORD);
// 60C0: using guessed type int dword_60C0;
// 2318: using guessed type char **var_8D0;
// 2318: using guessed type char var_850[16];

//----- (00000000000026D2) ----------------------------------------------------
__int64 __fastcall sub_26D2(unsigned __int8 a1)
{
  return dword_60E0[a1];
}
// 60E0: using guessed type unsigned int dword_60E0[256];

//----- (00000000000026F5) ----------------------------------------------------
__int64 __fastcall sub_26F5(unsigned __int8 *a1)
{
  __int64 result; // rax
  unsigned __int8 v2; // [rsp+13h] [rbp-5h]
  int i; // [rsp+14h] [rbp-4h]

  v2 = *a1;
  for ( i = 0; i <= 2; ++i )
    a1[i] = a1[i + 1];
  result = v2;
  a1[3] = v2;
  return result;
}

//----- (000000000000274D) ----------------------------------------------------
__int64 __fastcall sub_274D(unsigned __int8 a1)
{
  return byte_6080[a1];
}
// 6080: using guessed type unsigned __int8 byte_6080[32];

//----- (0000000000002769) ----------------------------------------------------
unsigned __int8 *__fastcall sub_2769(unsigned __int8 *a1, unsigned __int8 a2)
{
  unsigned __int8 v2; // bl
  unsigned __int8 v3; // bl
  unsigned __int8 *result; // rax
  int i; // [rsp+1Ch] [rbp-Ch]

  sub_26F5(a1);
  for ( i = 0; i <= 3; ++i )
    a1[i] = sub_26D2(a1[i]);
  v2 = *a1;
  v3 = sub_274D(a2) ^ v2;
  result = a1;
  *a1 = v3;
  return result;
}

//----- (00000000000027E7) ----------------------------------------------------
unsigned __int64 __fastcall sub_27E7(__int64 a1, __int64 a2, unsigned int a3, unsigned __int64 a4)
{
  unsigned __int8 v4; // al
  unsigned int v8; // [rsp+28h] [rbp-18h]
  int v9; // [rsp+2Ch] [rbp-14h]
  unsigned int i; // [rsp+30h] [rbp-10h]
  int j; // [rsp+30h] [rbp-10h]
  int k; // [rsp+30h] [rbp-10h]
  int m; // [rsp+30h] [rbp-10h]
  int v14; // [rsp+34h] [rbp-Ch] BYREF
  unsigned __int64 v15; // [rsp+38h] [rbp-8h]

  v15 = __readfsqword(0x28u);
  v9 = 1;
  v14 = 0;
  for ( i = 0; i < a3; ++i )
    *(_BYTE *)((int)i + a1) = *(_BYTE *)((int)i + a2);
  v8 = a3;
  while ( (int)v8 < a4 )
  {
    for ( j = 0; j <= 3; ++j )
      *((_BYTE *)&v14 + j) = *(_BYTE *)((int)(v8 - 4 + j) + a1);
    if ( !(v8 % a3) )
    {
      v4 = v9++;
      sub_2769((unsigned __int8 *)&v14, v4);
    }
    if ( a3 == 32 && v8 % 0x20 == 16 )
    {
      for ( k = 0; k <= 3; ++k )
        *((_BYTE *)&v14 + k) = sub_26D2(*((_BYTE *)&v14 + k));
    }
    for ( m = 0; m <= 3; ++m )
    {
      *(_BYTE *)((int)v8 + a1) = *((_BYTE *)&v14 + m) ^ *(_BYTE *)(v8 - a3 + a1);
      ++v8;
    }
  }
  return v15 - __readfsqword(0x28u);
}

//----- (0000000000002977) ----------------------------------------------------
void __fastcall sub_2977(__int64 a1)
{
  int i; // [rsp+14h] [rbp-Ch]

  for ( i = 0; i <= 15; ++i )
    *(_BYTE *)(i + a1) = sub_26D2(*(_BYTE *)(i + a1));
}

//----- (00000000000029C9) ----------------------------------------------------
__int64 __fastcall sub_29C9(__int64 a1)
{
  __int64 result; // rax
  int i; // [rsp+1Ch] [rbp-4h]

  for ( i = 0; i <= 3; ++i )
    result = sub_2A0C((char *)(4 * i + a1), i);
  return result;
}

//----- (0000000000002A0C) ----------------------------------------------------
__int64 __fastcall sub_2A0C(char *a1, unsigned __int8 a2)
{
  __int64 result; // rax
  char v3; // [rsp+13h] [rbp-9h]
  int i; // [rsp+14h] [rbp-8h]
  int j; // [rsp+18h] [rbp-4h]

  for ( i = 0; ; ++i )
  {
    result = a2;
    if ( i >= a2 )
      break;
    v3 = *a1;
    for ( j = 0; j <= 2; ++j )
      a1[j] = a1[j + 1];
    a1[3] = v3;
  }
  return result;
}

//----- (0000000000002A80) ----------------------------------------------------
_BYTE *__fastcall sub_2A80(__int64 a1, __int64 a2)
{
  _BYTE *result; // rax
  int i; // [rsp+1Ch] [rbp-4h]

  for ( i = 0; i <= 15; ++i )
  {
    result = (_BYTE *)(i + a1);
    *result ^= *(_BYTE *)(i + a2);
  }
  return result;
}

//----- (0000000000002AD6) ----------------------------------------------------
__int64 __fastcall sub_2AD6(char a1, unsigned __int8 a2)
{
  unsigned __int8 v5; // [rsp+15h] [rbp-3h]
  unsigned __int8 i; // [rsp+16h] [rbp-2h]
  char v7; // [rsp+17h] [rbp-1h]

  v5 = 0;
  for ( i = 0; i <= 7u; ++i )
  {
    if ( (a2 & 1) != 0 )
      v5 ^= a1;
    v7 = a1 & 0x80;
    a1 *= 2;
    if ( v7 == (char)0x80 )
      a1 ^= 0x1Bu;
    a2 >>= 1;
  }
  return v5;
}

//----- (0000000000002B30) ----------------------------------------------------
unsigned __int64 __fastcall sub_2B30(__int64 a1)
{
  int i; // [rsp+1Ch] [rbp-14h]
  int j; // [rsp+20h] [rbp-10h]
  int k; // [rsp+20h] [rbp-10h]
  char v5[4]; // [rsp+24h] [rbp-Ch] BYREF
  unsigned __int64 v6; // [rsp+28h] [rbp-8h]

  v6 = __readfsqword(0x28u);
  for ( i = 0; i <= 3; ++i )
  {
    for ( j = 0; j <= 3; ++j )
      v5[j] = *(_BYTE *)(4 * j + i + a1);
    sub_2BF8(v5);
    for ( k = 0; k <= 3; ++k )
      *(_BYTE *)(a1 + 4 * k + i) = v5[k];
  }
  return v6 - __readfsqword(0x28u);
}
// 2B30: using guessed type char var_C[4];

//----- (0000000000002BF8) ----------------------------------------------------
unsigned __int64 __fastcall sub_2BF8(_BYTE *a1)
{
  char v1; // bl
  char v2; // bl
  char v3; // bl
  char v4; // bl
  char v5; // bl
  char v6; // bl
  char v7; // bl
  char v8; // bl
  char v9; // bl
  int v10; // ebx
  int v11; // ebx
  int v12; // ebx
  int i; // [rsp+10h] [rbp-20h]
  char v15; // [rsp+14h] [rbp-1Ch]
  char v16; // [rsp+15h] [rbp-1Bh]
  char v17; // [rsp+16h] [rbp-1Ah]
  char v18; // [rsp+17h] [rbp-19h]
  unsigned __int64 v19; // [rsp+18h] [rbp-18h]

  v19 = __readfsqword(0x28u);
  for ( i = 0; i <= 3; ++i )
    *(&v15 + i) = a1[i];
  v1 = sub_2AD6(v15, 2u);
  v2 = sub_2AD6(v18, 1u) ^ v1;
  v3 = sub_2AD6(v17, 1u) ^ v2;
  *a1 = sub_2AD6(v16, 3u) ^ v3;
  v4 = sub_2AD6(v16, 2u);
  v5 = sub_2AD6(v15, 1u) ^ v4;
  v6 = sub_2AD6(v18, 1u) ^ v5;
  a1[1] = v6 ^ sub_2AD6(v17, 3u);
  v7 = sub_2AD6(v17, 2u);
  v8 = sub_2AD6(v16, 1u) ^ v7;
  v9 = sub_2AD6(v15, 1u) ^ v8;
  a1[2] = v9 ^ sub_2AD6(v18, 3u);
  v10 = sub_2AD6(v18, 2u);
  v11 = sub_2AD6(v17, 1u) ^ v10;
  v12 = sub_2AD6(v16, 1u) ^ v11;
  a1[3] = v12 ^ sub_2AD6(v15, 3u);
  return v19 - __readfsqword(0x28u);
}

//----- (0000000000002DD7) ----------------------------------------------------
_BYTE *__fastcall sub_2DD7(__int64 a1, __int64 a2)
{
  sub_2977(a1);
  sub_29C9(a1);
  sub_2B30(a1);
  return sub_2A80(a1, a2);
}

//----- (0000000000002E21) ----------------------------------------------------
__int64 __fastcall sub_2E21(__int64 a1, __int64 a2)
{
  __int64 result; // rax
  int i; // [rsp+18h] [rbp-8h]
  int j; // [rsp+1Ch] [rbp-4h]

  for ( i = 0; i <= 3; ++i )
  {
    for ( j = 0; j <= 3; ++j )
    {
      result = *(unsigned __int8 *)(4 * i + j + a1);
      *(_BYTE *)(4 * j + i + a2) = result;
    }
  }
  return result;
}

//----- (0000000000002E8E) ----------------------------------------------------
unsigned __int64 __fastcall sub_2E8E(__int64 a1, __int64 a2, int a3)
{
  int i; // [rsp+2Ch] [rbp-24h]
  char v6[24]; // [rsp+30h] [rbp-20h] BYREF
  unsigned __int64 v7; // [rsp+48h] [rbp-8h]

  v7 = __readfsqword(0x28u);
  sub_2E21(a2, (__int64)v6);
  sub_2A80(a1, v6);
  for ( i = 1; i < a3; ++i )
  {
    sub_2E21(a2 + 16 * i, (__int64)v6);
    sub_2DD7(a1, v6);
  }
  sub_2E21(a2 + 16 * a3, (__int64)v6);
  sub_2977(a1);
  sub_29C9(a1);
  sub_2A80(a1, v6);
  return v7 - __readfsqword(0x28u);
}
// 2977: using guessed type __int64 __fastcall sub_2977(_QWORD);
// 29C9: using guessed type __int64 __fastcall sub_29C9(_QWORD);
// 2A80: using guessed type __int64 __fastcall sub_2A80(_QWORD, _QWORD);
// 2DD7: using guessed type __int64 __fastcall sub_2DD7(_QWORD, _QWORD);

//----- (0000000000002F85) ----------------------------------------------------
__int64 __fastcall sub_2F85(__int64 a1, __int64 a2, __int64 a3, unsigned int a4)
{
  int v7; // [rsp+28h] [rbp-38h]
  int i; // [rsp+2Ch] [rbp-34h]
  int k; // [rsp+2Ch] [rbp-34h]
  int j; // [rsp+30h] [rbp-30h]
  int m; // [rsp+30h] [rbp-30h]
  void *ptr; // [rsp+38h] [rbp-28h]
  char v13[24]; // [rsp+40h] [rbp-20h] BYREF
  unsigned __int64 v14; // [rsp+58h] [rbp-8h]

  v14 = __readfsqword(0x28u);
  if ( a4 == 32 )
  {
    v7 = 14;
  }
  else
  {
    if ( a4 > 0x20 )
      return 1LL;
    if ( a4 == 16 )
    {
      v7 = 10;
    }
    else
    {
      if ( a4 != 24 )
        return 1LL;
      v7 = 12;
    }
  }
  ptr = malloc(16 * (v7 + 1));
  if ( !ptr )
    return 2LL;
  for ( i = 0; i <= 3; ++i )
  {
    for ( j = 0; j <= 3; ++j )
      v13[4 * j + i] = *(_BYTE *)(4 * i + j + a1);
  }
  sub_27E7((__int64)ptr, a3, a4, 16 * (v7 + 1));
  sub_2E8E((__int64)v13, (__int64)ptr, v7);
  for ( k = 0; k <= 3; ++k )
  {
    for ( m = 0; m <= 3; ++m )
      *(_BYTE *)(a2 + 4 * k + m) = v13[4 * m + k];
  }
  free(ptr);
  return 0LL;
}
// 2F85: using guessed type char var_20[24];

//----- (0000000000003128) ----------------------------------------------------
void term_proc()
{
  ;
}

// nfuncs=56 queued=31 decompiled=31 lumina nreq=0 worse=0 better=0
// ALL OK, 31 function(s) have been successfully decompiled
