from Crypto.Util.number import bytes_to_long
from py_ecc import bn128 as lib
from secrets import randbelow

p = lib.field_modulus

flag = b'REDACTED'
m = randbelow(p)

GF1 = GF(p)
E1 = EllipticCurve(GF1, [0, 3])
G1 = E1(1, 2)
G1m = G1 * m
print(f'{G1m = }')

# parameters from bn128 curve
GF2 = GF(p**2, 'a', modulus=x^2+1)
E2 = EllipticCurve(GF2, [0, GF2([3, 0]) / GF2([9, 1])])
G2 = E2(
    GF2([10857046999023057135944570762232829481370756359578518086990519993285655852781, 11559732032986387107991004021392285783925812861821192530917403151452391805634]),
    GF2([8495653923123431417604973247489272438418190587263600148770280649306958101930, 4082367875863433681332203403145435568316851327593401208105741076214120093531]),
)
G2m = G2 * m
print(f'{G2m = }')

# parameters from bn128 curve
GF12 = GF(p**12, 'a', modulus=x^12-18*x^6+82)

pairing_g2_g1 = GF12(eval(str(lib.pairing(lib.G2, lib.G1))))
enc = ((pairing_g2_g1^(m^2))^127) * bytes_to_long(flag)
print(f'{enc = }')

'''
G1m = (11469372800210105260727590463073506208044033830870930872330243851097831737764 : 1824583255701861010485373665759047621142115137095486777308222809009032384627 : 1)
G2m = (10459200952120625632845406741460650882569665318932155887689219394120633717306*a + 15370031806930629878263531909994337963970190011267915371085946350334444778727 : 9188400026649655679400691293973957726382241893634841873506254435507467101618*a + 19638478083949593397772590686912779106853349285972720902007677911656276830119 : 1)
enc = 3864929051102964770294276756692804239273448849099873077394178852707497643064*a^11 + 20592459928545191826931733511921601179763970567698700096883470199408432588353*a^10 + 14442249209778136460885125312318990997910124067725787191437742365669498874562*a^9 + 5379331772763743582759658896570540478579923692938865713050731429295324015283*a^8 + 9047824236807357977834487183478054588495363731447792566152885925688807697374*a^7 + 34426869692554077096277926338015839954618310968397888352589770015282878693*a^6 + 8805869281673333712522898617550637565846997079269810461911590752040993073633*a^5 + 5782763734139893395489033971251211762200693413700891931436104371864195853535*a^4 + 8034994451277825755315947148205896912060328517665483634343944698727982987334*a^3 + 21043663421638881664339906853012673403697552558755562449230033956422997523611*a^2 + 14322089096610513344946366113573287017575931462609011527179215866515759695992*a + 10615233709179433701441100887450799474654038525314314862623533557423396782383
'''