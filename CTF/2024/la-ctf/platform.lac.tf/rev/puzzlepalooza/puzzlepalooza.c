/* This file was generated by the Hex-Rays decompiler version 8.3.0.230608.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 (**init_proc())(void);
void sub_1020();
// int puts(const char *s);
// size_t strlen(const char *s);
// size_t strcspn(const char *s, const char *reject);
// char *fgets(char *s, int n, FILE *stream);
// int __fastcall _cxa_finalize(void *);
__int64 __fastcall main(int a1, char **a2, char **a3);
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void));
FILE **sub_1370();
__int64 sub_13A0(void); // weak
FILE **sub_13E0();
__int64 sub_1420();
void term_proc();
// int __fastcall _libc_start_main(int (__fastcall *main)(int, char **, char **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void), void *stack_end);
// int __fastcall __cxa_finalize(void *);
// __int64 _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

__int128 xmmword_20C0 = 0x519041807150214000F020405030601LL; // weak
__int128 xmmword_20D0 = 0x6350830002C0526082205210420031CLL; // weak
__int128 xmmword_20E0 = 0x6995AE4BBA65F79C9BACCB49FED06B08LL; // weak
__int128 xmmword_20F0 = 0xA8D9D3E542F4DEE06B4A18ED4EBCF308LL; // weak
__int128 xmmword_2100 = 0xA16160E71494ACF3CA8D9D3E542F4DELL; // weak
void *off_4028 = &off_4028; // idb
FILE *stdin; // idb
char byte_4038; // weak


//----- (0000000000001000) ----------------------------------------------------
__int64 (**init_proc())(void)
{
  __int64 (**result)(void); // rax

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    return (__int64 (**)(void))_gmon_start__();
  return result;
}
// 4078: using guessed type __int64 _gmon_start__(void);

//----- (0000000000001020) ----------------------------------------------------
void sub_1020()
{
  JUMPOUT(0LL);
}
// 1026: control flows out of bounds to 0

//----- (0000000000001080) ----------------------------------------------------
__int64 __fastcall main(int a1, char **a2, char **a3)
{
  char *_s; // rdi
  int k; // edx
  unsigned __int8 v5; // al
  int v7; // edx
  char *v8; // rdx
  int v9; // ebx
  int v10; // esi
  int v11; // r9d
  int v12; // r8d
  int v13; // edi
  unsigned int i; // eax
  int v15; // edx
  char v16; // cl
  unsigned int v17; // ecx
  unsigned int v18; // r14d
  unsigned int v19; // edx
  __m128i si128; // [rsp+0h] [rbp-F8h]
  __m128i v21[2]; // [rsp+10h] [rbp-E8h]
  __int128 v22[2]; // [rsp+30h] [rbp-C8h] BYREF
  __int64 v23; // [rsp+50h] [rbp-A8h]
  int v24; // [rsp+58h] [rbp-A0h]
  __int16 v25; // [rsp+5Ch] [rbp-9Ch]
  char v26; // [rsp+5Eh] [rbp-9Ah] BYREF
  char s[152]; // [rsp+60h] [rbp-98h] BYREF

  puts("Welcome to the greatest puzzlepalooza ever!");
  puts("Can you solve our puzzle without looking?");
  fgets(s, 100, stdin);
  s[strcspn(s, "\n")] = 0;
  if ( strlen(s) == 54 )
  {
    _s = s;
    k = 0;
    si128 = _mm_load_si128((const __m128i *)&xmmword_20E0);
    v21[0] = _mm_load_si128((const __m128i *)&xmmword_20F0);
    *(__m128i *)((char *)v21 + 9) = _mm_load_si128((const __m128i *)&xmmword_2100);
    while ( 1 )
    {
      v5 = *_s - 64;
      if ( v5 > 0x3Fu )
        break;
      si128.m128i_i8[k >> 3] ^= v5 << (k & 7);
      if ( (k & 7u) > 2 )
        si128.m128i_i8[(k >> 3) + 1] ^= (int)v5 >> (8 - (k & 7));
      k += 6;
      ++_s;
      if ( k == 324 )
      {
        if ( (si128.m128i_i8[0] & 0xFu) <= 8 )
        {
          v7 = 0;
          while ( ++v7 != 81 )
          {
            if ( (((int)si128.m128i_u8[v7 >> 1] >> (4 * (v7 & 1))) & 0xFu) > 8 )
              goto LABEL_7;
          }
          v8 = (char *)v22;
          v25 = 1871;
          v23 = 0x64A0847033B0136LL;
          v22[0] = (__int128)_mm_load_si128((const __m128i *)&xmmword_20C0);
          v24 = 38667339;
          v22[1] = (__int128)_mm_load_si128((const __m128i *)&xmmword_20D0);
          while ( v8[1] == (((int)si128.m128i_u8[(unsigned __int8)*v8 >> 1] >> (4 * (*v8 & 1))) & 0xF) )
          {
            v8 += 2;
            if ( &v26 == v8 )
            {
              v9 = 0;
              while ( 1 )
              {
                v10 = v9;
                v11 = 0;
                v12 = 0;
                v13 = 0;
                for ( i = 0; i != 9; ++i )
                {
                  v13 ^= 1 << (((int)si128.m128i_u8[(int)(i + 9 * v9) >> 1] >> (4 * ((i + 9 * v9) & 1))) & 0xF);
                  v15 = v10;
                  v16 = 4 * (v10 & 1);
                  v10 += 9;
                  v12 ^= 1 << (((int)si128.m128i_u8[v15 >> 1] >> v16) & 0xF);
                  v17 = i / 3 + v9 - v9 % 3;
                  v18 = 3 * (i / 3);
                  v19 = i;
                  v11 ^= 1 << (((int)si128.m128i_u8[(int)(3 * (v9 % 3) + v19 - v18 + 9 * v17) >> 1] >> (4 * ((3 * (v9 % 3) + v19 - v18 + 9 * v17) & 1))) & 0xF);
                }
                if ( v12 != 511 || v13 != 511 || v11 != 511 )
                  break;
                if ( ++v9 == 9 )
                {
                  puts("Woah! You're so good at puzzles!");
                  return 0LL;
                }
              }
              goto LABEL_7;
            }
          }
        }
        break;
      }
    }
  }
LABEL_7:
  puts("That's not a valid solution you silly goose!");
  return 1LL;
}
// 20C0: using guessed type __int128 xmmword_20C0;
// 20D0: using guessed type __int128 xmmword_20D0;
// 20E0: using guessed type __int128 xmmword_20E0;
// 20F0: using guessed type __int128 xmmword_20F0;
// 2100: using guessed type __int128 xmmword_2100;
// 1080: using guessed type char s[152];
// 1080: using guessed type __m128i var_E8[2];

//----- (0000000000001340) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void))
{
  __int64 v3; // rax
  int v4; // esi
  __int64 v5; // [rsp-8h] [rbp-8h] BYREF
  char *retaddr; // [rsp+0h] [rbp+0h] BYREF

  v4 = v5;
  v5 = v3;
  _libc_start_main((int (__fastcall *)(int, char **, char **))main, v4, &retaddr, 0LL, 0LL, a3, &v5);
  __halt();
}
// 1346: positive sp value 8 has been found
// 134D: variable 'v3' is possibly undefined

//----- (0000000000001370) ----------------------------------------------------
FILE **sub_1370()
{
  return &stdin;
}

//----- (00000000000013A0) ----------------------------------------------------
__int64 sub_13A0()
{
  return 0LL;
}
// 13A0: using guessed type __int64 sub_13A0();

//----- (00000000000013E0) ----------------------------------------------------
FILE **sub_13E0()
{
  FILE **result; // rax

  if ( !byte_4038 )
  {
    if ( &__cxa_finalize )
      _cxa_finalize(off_4028);
    result = sub_1370();
    byte_4038 = 1;
  }
  return result;
}
// 4038: using guessed type char byte_4038;

//----- (0000000000001420) ----------------------------------------------------
// attributes: thunk
__int64 sub_1420()
{
  return sub_13A0();
}
// 13A0: using guessed type __int64 sub_13A0(void);

//----- (0000000000001458) ----------------------------------------------------
void term_proc()
{
  ;
}

// nfuncs=21 queued=9 decompiled=9 lumina nreq=0 worse=0 better=0
// ALL OK, 9 function(s) have been successfully decompiled
